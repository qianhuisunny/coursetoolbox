"use strict";jQuery(document).ready((function($){n();var e=jQuery("#ddp_redirtable").DataTable({processing:!0,serverSide:!0,autoWidth:!0,ordering:!0,ajax:{url:ajaxurl,type:"POST",data:function(e){return jQuery.extend({},e,{action:"ddp_get_redirects",_ajax_nonce:cp_ddp.nonce})},dataSrc:function(e){return e.data}},columns:[{data:"ID",visible:!1},{data:"from_url",title:cp_ddp.fromUrlTitle},{data:"target_url",title:cp_ddp.targetUrlTitle}],select:{style:"multi"},dom:'<"top"Blfip>rt<"bottom"Blfip>',buttons:[{text:"Refresh",action:function(e,t,a,d){var r=$(a);r.prop("disabled",!0).text(cp_ddp.refreshingText),t.ajax.reload((function(){r.prop("disabled",!1).text(cp_ddp.refreshText)}))},className:"button button-secondary button-small"}],pageLength:10,rowCallback:function(e,t){jQuery(e).addClass("wp-list-table widefat fixed striped table-view-list")},lengthMenu:[[10,25,50,100,250,500],[10,25,50,100,250,500]]});e.on("error.dt",(function(e,t,a,d){e.preventDefault(),console.error("RedirectsDataTables error:",d,"TechNote:",a);var r=cp_ddp.errorDetailsText+d+(a?" (Tech note: "+a+")":"");jQuery("#ddp-dashboard .errormessage").html(cp_ddp.redirectsErrorText+r).show()})),e.buttons().container().appendTo("#ddp_redirtable_wrapper .top");var t=jQuery("#ddp_dupetable").DataTable({select:{style:"multi"},autoWidth:!0,processing:!0,language:{processing:'<div id="processingMessage">'+cp_ddp.processingMessage+"</div>"},serverSide:!0,searching:!1,ordering:!1,dom:'<"top"lip>rt<"bottom"ip><"clear">',ajax:{url:ajaxurl,type:"POST",data:function(e){return jQuery.extend({},e,{action:"ddp_get_duplicates",_ajax_nonce:cp_ddp.nonce})},dataSrc:function(e){return e.error?(jQuery("#ddp-dashboard .errormessage").html(e.error).show(),[]):e.data},beforeSend:function(){(new Date).getTime();jQuery("#requestTime").html(cp_ddp.requestTimeText),interval=setInterval(s,1e3),jQuery("#ddp_dupetable .dt-button").prop("disabled",!0),jQuery("#ddp_dupetable tbody").css("opacity","0.5")},complete:function(){clearInterval(interval),jQuery("#ddp_dupetable tbody").css("opacity","1"),jQuery("#ddp_dupetable .dt-button").prop("disabled",!1),n()},error:function(e,t,a){console.error("AJAX error:",t,a);var d="Status: "+t+", Error: "+a+", Response: "+e.responseText;return jQuery("#ddp-dashboard .errormessage").html(cp_ddp.failedToLoadDataText+d).show(),[]}},columns:[{data:"ID",visible:!1},{data:"orgID",visible:!1},{data:"duplicate",title:cp_ddp.duplicateTitle,orderable:!1},{data:"original",title:cp_ddp.originalTitle,orderable:!1}],rowCallback:function(e){jQuery(e).addClass("wp-list-table widefat fixed striped table-view-list")},lengthMenu:[[10,25,50,100,250,500],[10,25,50,100,250,500]]});function a(){t.ajax.reload()}function d(){var e=t.rows({selected:!0}).data();if(0!==e.length){if(confirm(cp_ddp.text_areyousure)){var a=[];jQuery.each(e,(function(e,t){a.push({ID:t.ID,orgID:t.orgID})})),jQuery.ajax({type:"POST",url:ajaxurl,data:{_ajax_nonce:cp_ddp.deletedupes_nonce,action:"ddp_delete_duplicates",checked_posts:a},success:function(e){if(e.success)t.ajax.reload(null,!1),n();else{var a=e.data&&e.data.message?e.data.message:"Unknown error occurred";alert(cp_ddp.serverResponseText+a)}},error:function(e,t,a){alert(cp_ddp.errorOccurredText+" "+t)}})}}else alert(cp_ddp.selectRowAlert)}function r(){t.rows({page:"current"}).select()}function o(){t.rows().deselect()}function s(){var e=((new Date).getTime()-startTime)/1e3;jQuery("#requestTime").html(cp_ddp.requestTimeText+e+" sec."),jQuery("#processingMessage").html(cp_ddp.processingMessage+e+" sec.")}function n(){jQuery("#ddp_log").empty(),jQuery.ajax({type:"POST",url:ajaxurl,data:{_ajax_nonce:cp_ddp.loglines_nonce,action:"ddp_get_loglines"},dataType:"json",success:function(e){let t=e.data.results;t&&jQuery.each(t,(function(e,t){jQuery("#ddp_log").append("<li><code>"+t.datime+"</code> "+t.note+"</li>")})),jQuery("#log .spinner").removeClass("is-active")}}).fail((function(e){jQuery("#log .spinner").removeClass("is-active"),window.console&&window.console.log&&window.console.log(e.statusCode+" "+e.statusText)}))}function c(e,t,a){jQuery.ajax({type:"POST",url:ajaxurl,data:{_ajax_nonce:cp_ddp.nonce,action:"ddp_get_duplicates",stepid:e},dataType:"json",success:function(e){let d=e.data.dupes;d?(jQuery("#ddp_container #dashboard .statusdiv .statusmessage").html(e.data.msg).show(),jQuery("#ddp_container #dashboard .statusdiv .dupelist .duplicatetable").show(),jQuery.each(d,(function(e,t){jQuery("#ddp_container #dashboard .statusdiv .dupelist .duplicatetable tbody").append('<tr><th scope="row" class="check-column"><label class="screen-reader-text" for="cb-select-'+t.ID+'">Select Post</label><input id="cb-select-'+t.ID+'" type="checkbox" name="delpost[]" value="'+t.ID+'" data-orgid="'+t.orgID+'"><div class="locked-indicator"></div></th><td><a href="'+t.permalink+'" target="_blank">'+t.title+"</a> (ID #"+t.ID+" type:"+t.type+" status:"+t.status+')</td><td><a href="'+t.orgpermalink+'" target="_blank">'+t.orgtitle+"</a> (ID #"+t.orgID+") "+t.why+"</td></tr>")})),jQuery("#ddp_container #dashboard .statusdiv .dupelist .duplicatetable tbody").slideDown()):jQuery("#ddp_container #dashboard .statusdiv .statusmessage").html(e.data.msg).show(),"-1"==e.data.nextstep?jQuery("#ddp_container #dashboard .statusdiv .errormessage").text(cp_ddp.somethingWentWrongText).show():parseInt(e.data.nextstep)>0&&c(parseInt(e.data.nextstep),t,a)}}).fail((function(e){window.console&&window.console.log&&window.console.log(e.statusCode+" "+e.statusText)}))}t.on("error.dt",(function(e,t,a,d){e.preventDefault();var r="Error details: "+d+(a?" (Tech note: "+a+")":"");jQuery("#ddp-dashboard .errormessage").html("DataTables error occurred. "+r).show()})),$.fn.dataTable.ext.errMode="none",function(){var e=jQuery("<div/>",{class:"dt-buttons"});return e.append(jQuery("<button/>",{text:cp_ddp.refreshText,click:a,class:"dt-button button button-secondary button-small"})),e.append(jQuery("<button/>",{text:cp_ddp.deleteSelectedText,click:d,class:"dt-button button button-secondary button-small ddp-delete-selected"})),e.append(jQuery("<button/>",{text:cp_ddp.selectVisibleText,click:r,class:"dt-button button button-secondary button-small"})),e.append(jQuery("<button/>",{text:cp_ddp.selectNoneText,click:o,class:"dt-button button button-secondary button-small"})),e}().insertBefore("#ddp_dupetable_paginate"),jQuery("#ddp_dupetable tbody").on("click","tr",(function(){jQuery(this).toggleClass("selected")})),jQuery(document).on("click","#deleteduplicateposts_resetview",(function(e){e.preventDefault(),jQuery("#ddp_container .dupelist .duplicatetable tbody").empty(),c(1,senddata),n()})),jQuery(document).on("click",".ddpcomparemethod li",(function(){jQuery(".ddpcomparemethod input:radio").each((function(){this.checked?jQuery(this).closest("li").find(".ddp-compare-details").show():jQuery(this).closest("li").find(".ddp-compare-details").hide()}))})),jQuery(".ddpcomparemethod li").trigger("click")}));